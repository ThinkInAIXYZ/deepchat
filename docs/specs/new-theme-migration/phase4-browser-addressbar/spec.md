# Phase 4: Browser 地址栏整合 - 需求规格说明书

## 用户故事

作为 DeepChat 用户，我希望在 Browser 窗口中有内嵌的地址栏，以便更方便地浏览网页和管理导航。

## 业务价值

- **移除 Shell 依赖**: Browser 不再需要依赖 Shell 层的 BrowserToolbar
- **统一体验**: Browser 页面内嵌地址栏，与主流浏览器体验一致
- **为后续功能铺路**: 可以在地址栏添加更多 Browser 特有功能

## 现状分析

当前架构（Phase 1 后）：
- Browser 窗口直接加载 `local://browser`
- BrowserToolbar 随 Shell 一起被移除
- Browser 页面目前没有内嵌地址栏

目标架构：
- Browser 页面顶部显示地址栏
- 地址栏包含：前进/后退、刷新、地址输入、新标签页（如适用）
- 地址栏与 WebContentsView 交互

## 验收标准

### 功能性标准

1. **地址栏显示**
   - [ ] Browser 页面顶部显示地址栏
   - [ ] 地址栏高度约 40px
   - [ ] 地址栏样式与主题一致

2. **导航按钮**
   - [ ] 显示前进按钮，可以前进浏览历史
   - [ ] 显示后退按钮，可以后退浏览历史
   - [ ] 按钮在有历史可前进/后退时高亮
   - [ ] 按钮在无历史时禁用

3. **地址输入**
   - [ ] 显示当前页面 URL
   - [ ] 可以点击编辑 URL
   - [ ] 输入 URL 按 Enter 导航到该地址
   - [ ] 输入时显示 URL 联想/补全（可选）

4. **刷新按钮**
   - [ ] 显示刷新按钮
   - [ ] 点击刷新当前页面

5. **WebContentsView 整合**
   - [ ] 地址栏下方显示 WebContentsView
   - [ ] WebContentsView 高度占满剩余空间
   - [ ] 地址栏与 WebContentsView 交互正常

6. **与 YoBrowserPresenter 交互**
   - [ ] 地址栏可以接收来自 presenter 的导航指令
   - [ ] 页面导航时地址栏 URL 更新

### 非功能性标准

- [ ] 地址栏响应迅速
- [ ] 页面加载时显示加载指示

## 非目标（明确不做）

1. **不实现多标签页**: Browser 仍保持单标签页
2. **不实现书签功能**: 书签管理不在此 Phase
3. **不实现开发者工具**: DevTools 不在此 Phase
4. **不改改动 YoBrowser 的核心功能**: 只改动 UI 层

## 界面变化

### Before (Phase 1 后)
```
┌─────────────────────────────────────┐
│                                     │
│  Browser View                       │
│  (只有 WebContentsView，无地址栏)  │
│                                     │
│                                     │
│                                     │
└─────────────────────────────────────┘
```

### After (Phase 4 后)
```
┌─────────────────────────────────────┐
│ ← → ⟳ [地址栏输入            ] [+] │  ← 地址栏 (40px)
├─────────────────────────────────────┤
│                                     │
│                                     │
│     WebContentsView                 │
│     (网页内容)                      │
│                                     │
│                                     │
└─────────────────────────────────────┘
```

## 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| WebContentsView 与地址栏通信复杂 | 中 | 通过 IPC 和 EventBus 实现 |
| 地址栏样式与主题不统一 | 低 | 使用 Tailwind 和 shadcn 组件 |

## 验收测试清单

- [ ] Browser 窗口显示地址栏
- [ ] 后退/前进按钮工作
- [ ] 地址输入框显示当前 URL
- [ ] 编辑地址并导航工作
- [ ] 刷新按钮工作
- [ ] 页面加载时地址栏更新
- [ ] 运行 `pnpm run typecheck` 通过
- [ ] 运行 `pnpm run lint` 通过
