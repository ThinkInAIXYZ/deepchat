# Phase 5: Settings 和历史会话整合 - 需求规格说明书

## 用户故事

作为 DeepChat 用户，我希望通过 WindowSideBar 快速访问 Settings 和历史会话，以便更方便地管理应用配置和查看过往对话。

## 业务价值

- **统一入口**: Settings 和历史会话都在 WindowSideBar 中管理
- **减少操作步骤**: 不需要额外打开窗口即可访问常用功能
- **界面一致性**: 所有功能通过统一的侧边栏访问

## 现状分析

当前架构：
- Settings 通过独立 Tab 或窗口打开
- 历史会话在 ChatTabView 中显示
- WindowSideBar 左侧有设置按钮占位

目标架构：
- Settings 按钮在 WindowSideBar 左侧底部
- 点击 Settings 按钮在右侧区域显示设置面板
- 历史会话列表整合到 WindowSideBar 右侧（已在 Phase 2 完成）

## Settings 整合设计

### 触发方式

**位置**: WindowSideBar 左侧底部（Agent 按钮列下方）

**图标**: 齿轮/设置图标

**交互**:
- 点击 Settings 按钮
- 中间区域显示设置内容（替换 NewThread）
- 或者：右侧区域显示设置内容

### 设置内容显示方式（需决策）

**方案 A: 中间区域显示**
- 点击 Settings，中间 NewThread 区域替换为 Settings 内容
- 右侧历史会话仍可显示

**方案 B: 右侧区域显示**
- 点击 Settings，右侧历史会话区域替换为 Settings 内容
- 中间保持 NewThread

**方案 C: 独立弹窗（推荐）**
- 点击 Settings，打开独立设置弹窗
- 不占用主界面空间
- 符合大多数应用的设计模式

## 历史会话整合（已在 Phase 2 完成）

确认 Phase 2 的实现满足需求：
- [ ] 右侧 240px 区域显示历史会话
- [ ] 按时间分组显示
- [ ] 点击会话打开对应聊天

## 验收标准

### Settings 功能标准

1. **Settings 入口**
   - [ ] WindowSideBar 左侧显示 Settings 按钮
   - [ ] 按钮位置在 Agent 按钮列下方
   - [ ] 按钮图标为设置图标

2. **Settings 显示**
   - [ ] 点击 Settings 按钮打开设置界面
   - [ ] 设置界面功能完整（所有设置项可用）
   - [ ] 可以关闭设置界面返回主界面

3. **与现有设置兼容**
   - [ ] 现有设置配置正确加载
   - [ ] 设置修改正确保存

### 历史会话功能标准（确认 Phase 2）

1. **历史会话显示**
   - [ ] 右侧区域显示历史会话列表
   - [ ] 按时间分组（Today、Yesterday、Last Week）
   - [ ] 会话标题正确显示

2. **历史会话交互**
   - [ ] 点击会话打开对应聊天
   - [ ] 当前会话高亮显示

## 非目标（明确不做）

1. **不重构 Settings 内部结构**: 只改动入口方式，Settings 内部组件不变
2. **不添加新设置项**: 本 Phase 只改动入口
3. **不改改动历史会话数据结构**: 使用现有数据模型

## 界面变化

### Settings 入口
```
┌────────┬──────────────────┬─────────┐
│        │                  │         │
│  48px  │   NewThread      │  240px  │
│ Agent  │   (中间内容区)    │ History │
│ Buttons│                  │  or     │
│        │                  │ Settings│
│ [All]  │                  │         │
│ [Claude│                  │ Today   │
│ [本地] │                  │ - Chat 1│
│        │                  │         │
│ [设置] │                  │ Yesterday
│        │                  │ - Chat 2│
└────────┴──────────────────┴─────────┘
         ↑ 设置按钮在底部
```

### 设置弹窗（方案 C）
```
┌─────────────────────────────────────┐
│  DeepChat                           │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │       Settings 弹窗          │   │
│  │                             │   │
│  │  [General] [Models] [MCP]   │   │
│  │                             │   │
│  │  设置内容...                 │   │
│  │                             │   │
│  │              [Cancel] [Save]│   │
│  └─────────────────────────────┘   │
│                                     │
│  主界面内容（遮罩）                  │
│                                     │
└─────────────────────────────────────┘
```

## 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Settings 内容太多，不适合侧边栏 | 中 | 使用弹窗方案 |
| 与现有 Settings 打开方式冲突 | 低 | 统一改为新的入口方式 |

## 验收测试清单

- [ ] WindowSideBar 左侧显示 Settings 按钮
- [ ] 点击 Settings 按钮打开设置
- [ ] 设置功能完整可用
- [ ] 可以关闭设置返回主界面
- [ ] 历史会话列表正常显示
- [ ] 运行 `pnpm run typecheck` 通过
- [ ] 运行 `pnpm run lint` 通过
