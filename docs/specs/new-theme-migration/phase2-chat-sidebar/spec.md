# Phase 2: WindowSideBar é‡æ„è§„æ ¼æ–‡æ¡£

## 1. æ¦‚è¿°

é‡æ„ WindowSideBar ç»„ä»¶ï¼Œå®ç°ä¸‰åˆ—å¸ƒå±€ï¼š**ä¼šè¯åˆ—è¡¨**ï¼ˆå·¦ï¼Œ288pxï¼‰+ **ä¼šè¯å†…å®¹**ï¼ˆä¸­ï¼Œè‡ªé€‚åº”ï¼‰+ **ä¸Šä¸‹æ–‡é¢æ¿**ï¼ˆå³ï¼Œå¯é€‰ï¼‰ã€‚

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š
- **ä¼šè¯å†å²å§‹ç»ˆæ˜¯æ ¸å¿ƒ**ï¼šä»»ä½• Agent/Model Tab å†…æ˜¾ç¤ºçš„éƒ½æ˜¯è¯¥æ¥æºçš„å†å²ä¼šè¯åˆ—è¡¨
- **å·¦ä¾§è¾¹æ ä¿ç•™åŸæœ‰æ ·å¼**ï¼šåŸºäºç°æœ‰ WindowSideBar.vue çš„æ ·å¼è¿›è¡Œæ‰©å±•ï¼Œä¸ç ´ååŸæœ‰è§†è§‰è®¾è®¡
- **All Agents / ACP Agent / Local Model æ˜¯è¿‡æ»¤å™¨**ï¼šä¸æ˜¯é€‰æ‹©å™¨ï¼Œè€Œæ˜¯ç­›é€‰æ¡ä»¶

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•°æ®ç»“æ„

```typescript
// æ¥è‡ª chat.ts store
interface ThreadGroup {
  dt: string              // æ—¥æœŸåˆ†ç»„: "Today", "Yesterday", "Last Week"
  dtThreads: CONVERSATION[]
}

// CONVERSATION å…³é”®å­—æ®µ
interface CONVERSATION {
  id: string
  title: string
  settings: {
    providerId: string      // 'acp' è¡¨ç¤º ACP Agentï¼Œå…¶ä»–ä¸ºæ™®é€šæ¨¡å‹ Provider
    modelId: string         // å…·ä½“æ¨¡å‹/Agent ID
    chatMode?: 'agent' | 'acp agent'
  }
  createdAt: number
  updatedAt: number
}
```

### 2.2 Tab åˆ†ç±»é€»è¾‘

**All Agents Tab**ï¼š
- æ˜¾ç¤ºæ‰€æœ‰å†å²ä¼šè¯ï¼ˆä¸åŒºåˆ†æ¥æºï¼‰
- æŒ‰æ—¥æœŸåˆ†ç»„ï¼ˆToday/Yesterday/Last Week/Earlierï¼‰

**æ¯ä¸ª ACP Agent ä¸€ä¸ªç‹¬ç«‹ Tab**ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ï¼š
- è¯†åˆ«æ¡ä»¶ï¼š`conversation.settings.providerId === 'acp'`
- æŒ‰ `conversation.settings.modelId` åˆ†ç»„
- ä¾‹å¦‚ï¼šClaudeã€Codexã€Gemini ç­‰å„è‡ªä¸€ä¸ª Tab
- æ¯ä¸ª Tab å†…æ˜¾ç¤ºè¯¥ Agent çš„å†å²ä¼šè¯åˆ—è¡¨

**æ¯ä¸ª Local Model ä¸€ä¸ªç‹¬ç«‹ Tab**ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ï¼š
- è¯†åˆ«æ¡ä»¶ï¼š`conversation.settings.providerId !== 'acp'`
- æŒ‰ `conversation.settings.providerId + modelId` åˆ†ç»„
- ä¾‹å¦‚ï¼šGPT-4ã€DeepSeekã€æœ¬åœ° Ollama æ¨¡å‹ç­‰å„è‡ªä¸€ä¸ª Tab
- æ¯ä¸ª Tab å†…æ˜¾ç¤ºè¯¥æ¨¡å‹çš„å†å²ä¼šè¯åˆ—è¡¨

### 2.3 ä¾§è¾¹æ å¸ƒå±€

ä¿æŒåŸæœ‰ WindowSideBar ç»“æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WindowSideBar (288px)                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 48px     â”‚ 240px                                                  â”‚
â”‚          â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  ğŸ‘¤  â”‚ â”‚ â”‚ All Agents                    [+ New Chat]        â”‚  â”‚
â”‚ â”‚ All  â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ Today                                               â”‚  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”œâ”€ Fix login bug                         â—        â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”œâ”€ Refactor auth module                  ğŸ”„       â”‚  â”‚
â”‚ â”‚  ğŸ§   â”‚ â”‚ â”‚ â”œâ”€ Write unit tests                              â”‚  â”‚
â”‚ â”‚Claudeâ”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ Yesterday                                           â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”œâ”€ Add dark mode support               âœ“        â”‚  â”‚
â”‚ â”‚  âš¡  â”‚ â”‚ â”‚ â”œâ”€ API integration                     âš ï¸        â”‚  â”‚
â”‚ â”‚GPT-4 â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚                                                        â”‚
â”‚ â”‚  ğŸ”§  â”‚ â”‚                                                        â”‚
â”‚ â”‚Codex â”‚ â”‚                                                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚                                                        â”‚
â”‚ â”‚  ğŸŒ  â”‚ â”‚                                                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚                                                        â”‚
â”‚ â”‚  â‹®   â”‚ â”‚                                                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                        â”‚
â”‚          â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. äº¤äº’è®¾è®¡

### 3.1 Tab åˆ‡æ¢

**å·¦åˆ—å›¾æ ‡ç‚¹å‡»**ï¼š
- **All Agents å›¾æ ‡**ï¼šåˆ‡æ¢åˆ° All Agents Tabï¼Œå³åˆ—æ˜¾ç¤ºæ‰€æœ‰å†å²ä¼šè¯
- **ACP Agent å›¾æ ‡**ï¼ˆæ¯ä¸ª Agent ä¸€ä¸ªå›¾æ ‡ï¼‰ï¼šåˆ‡æ¢åˆ°è¯¥ Agent Tabï¼Œå³åˆ—æ˜¾ç¤ºè¯¥ Agent çš„å†å²ä¼šè¯
- **Local Model å›¾æ ‡**ï¼ˆæ¯ä¸ªæ¨¡å‹ä¸€ä¸ªå›¾æ ‡ï¼‰ï¼šåˆ‡æ¢åˆ°è¯¥ Model Tabï¼Œå³åˆ—æ˜¾ç¤ºè¯¥ Model çš„å†å²ä¼šè¯

**çŠ¶æ€æ˜¾ç¤º**ï¼š
- å½“å‰é€‰ä¸­çš„ Tab å›¾æ ‡é«˜äº®ï¼ˆå¸¦è¾¹æ¡†èƒŒæ™¯ï¼‰
- å…¶ä»–å›¾æ ‡é»˜è®¤çŠ¶æ€

### 3.2 ä¼šè¯åˆ—è¡¨

**å³åˆ—æ˜¾ç¤ºå†…å®¹**ï¼š
- Headerï¼šå½“å‰ Tab åç§° + [+ New Chat] æŒ‰é’®
- ä¼šè¯åˆ—è¡¨ï¼šæŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤ºä¼šè¯æ ‡é¢˜
- çŠ¶æ€å›¾æ ‡ï¼š
  - `working`ï¼šæ˜¾ç¤ºæ—‹è½¬çš„ loader
  - `completed`ï¼šæ˜¾ç¤ºç»¿è‰²å¯¹å‹¾
  - `error`ï¼šæ˜¾ç¤ºçº¢è‰²è­¦å‘Š
  - `none`ï¼šä¸æ˜¾ç¤ºå›¾æ ‡

**ä¼šè¯ç‚¹å‡»**ï¼š
- ç‚¹å‡»ä¼šè¯æ ‡é¢˜ï¼šåˆ‡æ¢åˆ°è¯¥ä¼šè¯
- æ›´æ–°é€‰ä¸­çŠ¶æ€ï¼ˆé«˜äº®èƒŒæ™¯ï¼‰

### 3.3 æ–°å»ºä¼šè¯

**ç‚¹å‡» [+ New Chat] æŒ‰é’®**ï¼š
- æ ¹æ®å½“å‰é€‰ä¸­çš„ Tabï¼Œä½¿ç”¨å¯¹åº”çš„ Agent/Model åˆ›å»ºæ–°ä¼šè¯
- All Agents Tabï¼šä½¿ç”¨é»˜è®¤æ¨¡å‹åˆ›å»º
- ACP Agent Tabï¼šä½¿ç”¨è¯¥ Agent åˆ›å»º
- Local Model Tabï¼šä½¿ç”¨è¯¥ Model åˆ›å»º

## 4. æ•°æ®æµ

### 4.1 åˆå§‹åŒ–æµç¨‹

```
WindowSideBar mounted
    â”‚
    â”œâ”€â”€> chatStore åŠ è½½å†å²ä¼šè¯ (chatStore.threads)
    â”‚
    â”œâ”€â”€> agentModelStore åŠ è½½å¯ç”¨æ¨¡å‹
    â”‚    â”œâ”€â”€> ACP Agents (providerId = 'acp')
    â”‚    â””â”€â”€> Local Models (providerId â‰  'acp')
    â”‚
    â””â”€â”€> æ„å»º Tab åˆ—è¡¨
         â”œâ”€â”€> All Agents Tab (å›ºå®š)
         â”œâ”€â”€> ACP Agent Tabs (åŠ¨æ€ï¼ŒæŒ‰ modelId åˆ†ç»„)
         â””â”€â”€> Local Model Tabs (åŠ¨æ€ï¼ŒæŒ‰ providerId + modelId åˆ†ç»„)
```

### 4.2 ä¼šè¯è¿‡æ»¤é€»è¾‘

```typescript
// All Agents - æ˜¾ç¤ºæ‰€æœ‰
const allSessions = chatStore.threads

// ACP Agent Tab (å¦‚ Claude) - è¿‡æ»¤ providerId === 'acp' && modelId === 'claude'
const acpAgentSessions = chatStore.threads
  .flatMap(g => g.dtThreads)
  .filter(c => c.settings.providerId === 'acp' && c.settings.modelId === 'claude')
  .groupByDate()

// Local Model Tab (å¦‚ GPT-4) - è¿‡æ»¤ providerId !== 'acp' && modelId === 'gpt-4'
const localModelSessions = chatStore.threads
  .flatMap(g => g.dtThreads)
  .filter(c => c.settings.providerId !== 'acp' && c.settings.modelId === 'gpt-4')
  .groupByDate()
```

### 4.3 å®æ—¶æ›´æ–°

**ç›‘å¬äº‹ä»¶**ï¼š
- `CONVERSATION_EVENTS.LIST_UPDATED`ï¼šä¼šè¯åˆ—è¡¨æ›´æ–°æ—¶åˆ·æ–°æ˜¾ç¤º
- `CONVERSATION_EVENTS.TITLE_UPDATED`ï¼šä¼šè¯æ ‡é¢˜æ›´æ–°æ—¶åˆ·æ–°
- `CONVERSATION_EVENTS.DELETED`ï¼šä¼šè¯åˆ é™¤æ—¶åˆ·æ–°

## 5. è¾¹ç•Œæƒ…å†µ

### 5.1 æ— ä¼šè¯çŠ¶æ€

**All Agents Tab**ï¼š
- å³åˆ—æ˜¾ç¤ºç©ºçŠ¶æ€æç¤ºï¼š"No conversations yet"
- æä¾›å¿«æ·æ–°å»ºæŒ‰é’®

**ç‰¹å®š Agent/Model Tab**ï¼š
- å¦‚æœè¯¥ Agent/Model æ²¡æœ‰å†å²ä¼šè¯
- æ˜¾ç¤ºï¼š"No conversations with {AgentName}"
- æä¾› "Start a new chat" æŒ‰é’®

### 5.2 Agent/Model ä¸å¯ç”¨

- å¦‚æœæŸä¸ª ACP Agent é…ç½®è¢«åˆ é™¤
- è¯¥ Tab ä»ç„¶æ˜¾ç¤ºï¼ˆä¿ç•™å†å²ä¼šè¯è®¿é—®ï¼‰
- ä½†æ–°å»ºä¼šè¯æ—¶æç¤º Agent ä¸å¯ç”¨

### 5.3 å¤§é‡ä¼šè¯

- æ”¯æŒè™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µåŠ è½½
- åˆå§‹åŠ è½½æœ€è¿‘ 50 æ¡ä¼šè¯
- æ»šåŠ¨åˆ°åº•éƒ¨æ—¶åŠ è½½æ›´å¤š

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 è®¡ç®—ä¼˜åŒ–

- ä½¿ç”¨ `computed` ç¼“å­˜è¿‡æ»¤åçš„ä¼šè¯åˆ—è¡¨
- é¿å…åœ¨æ¸²æŸ“æ—¶é‡å¤è®¡ç®—åˆ†ç»„

### 6.2 æ¸²æŸ“ä¼˜åŒ–

- ä½¿ç”¨ `v-for` çš„ `:key` ç¡®ä¿æ­£ç¡®å¤ç”¨
- ä¼šè¯çŠ¶æ€å˜åŒ–æ—¶åªæ›´æ–°å¯¹åº”é¡¹

## 7. ä¾èµ–å…³ç³»

### 7.1 Store ä¾èµ–

```typescript
// chat.ts - æä¾›å†å²ä¼šè¯æ•°æ®
const chatStore = useChatStore()
const { threads, getThreadWorkingStatus } = chatStore

// agentModelStore.ts - æä¾›å¯ç”¨ Agents/Models
const agentModelStore = useAgentModelStore()
const { agentModels, refreshAgentModels } = agentModelStore
```

### 7.2 Presenter ä¾èµ–

```typescript
// æ–°å»ºä¼šè¯
const sessionPresenter = usePresenter('sessionPresenter')

// æ‰“å¼€è®¾ç½®/æµè§ˆå™¨
const windowPresenter = usePresenter('windowPresenter')
const yoBrowserPresenter = usePresenter('yoBrowserPresenter')
```

## 8. éªŒæ”¶æ ‡å‡†

### 8.1 åŠŸèƒ½éªŒæ”¶

- [ ] All Agents Tab æ˜¾ç¤ºæ‰€æœ‰å†å²ä¼šè¯ï¼ˆæŒ‰æ—¥æœŸåˆ†ç»„ï¼‰
- [ ] æ¯ä¸ª ACP Agent æœ‰ç‹¬ç«‹çš„ Tab
- [ ] æ¯ä¸ª Local Model æœ‰ç‹¬ç«‹çš„ Tab
- [ ] ç‚¹å‡» Tab å›¾æ ‡æ­£ç¡®è¿‡æ»¤æ˜¾ç¤ºå¯¹åº”ä¼šè¯
- [ ] ä¼šè¯çŠ¶æ€æ­£ç¡®æ˜¾ç¤ºï¼ˆworking/completed/error/noneï¼‰
- [ ] ç‚¹å‡»ä¼šè¯æ ‡é¢˜å¯ä»¥åˆ‡æ¢åˆ°è¯¥ä¼šè¯
- [ ] [+ New Chat] æ ¹æ®å½“å‰ Tab ä½¿ç”¨å¯¹åº” Agent/Model åˆ›å»ºä¼šè¯
- [ ] Settings å’Œ YoBrowser æŒ‰é’®æ­£å¸¸å·¥ä½œ

### 8.2 è§†è§‰éªŒæ”¶

- [ ] å·¦åˆ—å®½åº¦ 48pxï¼Œå³åˆ—å®½åº¦ 240px
- [ ] å½“å‰é€‰ä¸­ Tab å›¾æ ‡é«˜äº®æ˜¾ç¤º
- [ ] ä¼šè¯åˆ—è¡¨æŒ‰æ—¥æœŸåˆ†ç»„ï¼ˆToday/Yesterday/Last Week/Earlierï¼‰
- [ ] æš—è‰²/äº®è‰²ä¸»é¢˜æ­£å¸¸æ˜¾ç¤º
- [ ] ç©ºçŠ¶æ€æç¤ºæ¸…æ™°æ˜ç¡®

### 8.3 æ€§èƒ½éªŒæ”¶

- [ ] åˆå§‹åŠ è½½ < 500msï¼ˆ100 æ¡ä¼šè¯ä»¥å†…ï¼‰
- [ ] Tab åˆ‡æ¢ < 100ms
- [ ] æ»šåŠ¨æµç•…æ— å¡é¡¿

## 9. ç›¸å…³æ–‡ä»¶

- `src/renderer/src/components/WindowSideBar.vue` - ä¸»è¦å®ç°æ–‡ä»¶
- `src/renderer/src/stores/chat.ts` - ä¼šè¯æ•°æ® Store
- `src/renderer/src/stores/agentModelStore.ts` - Agent/Model æ•°æ® Store
- `src/shared/types/presenters/thread.presenter.d.ts` - CONVERSATION ç±»å‹å®šä¹‰
